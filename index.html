<!-- 
** Knockout Validate Demo (https://github.com/Skiggz/knockout-validate)
** Skylar Lowery (https://github.com/Skiggz)
** License: MIT (http://www.opensource.org/licenses/mit-license.php)
** Thanks google pretty print and bootstrap CSS!
** 
** Google Pretty Print: https://code.google.com/p/google-code-prettify
**
** Bootstrap CSS: http://getbootstrap.com/index.html
**
** And of course, get knockout in your app!
** http://knockoutjs.com/
**
-->
<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Knockout Validate Demo</title>
		<!-- Bootstrap CSS -->
		<link rel="stylesheet" href="resources/bootstrap.css">
		<!-- Pretty up JS with Google Pretty Print -->
		<link rel='stylesheet' href='resources/prettify.css' />
		<script src="resources/prettify.js"></script>
		<!-- Knockout -->
		<script src="resources/knockout.js"></script>
		<!-- Knockout Validate -->
		<script src="src/knockout-validate.js"></script>
		<style type="text/css">
			.code-wrapper {
				border: 1px solid transparent;
				border-radius: 6px;
			}
			.code-display {
				padding: 10px;
			}
			.code-display .indent-1 {
				padding-left: 2em;
			}
			.code-display .indent-2 {
				padding-left: 4em;
			}
			footer {
				margin-bottom: 100px;
			}
		</style>
		<script type="text/javascript">
			ko.validate.Demo = function() {
				var self = this;

				// We can use knockout-validate to ensure our flags are all booleans
				var validBoolean = function(value) {
					return typeof value === 'boolean';
				};

				// Valid flags for UI
				this.validEmail = ko.validate.observable(true, validBoolean);
				this.validPassword = ko.validate.observable(true, validBoolean);
				this.passwordsMatch = ko.validate.observable(true, validBoolean);

				/*
					A somewhat basic email regex. Not fool-proof
					but matches most emails

					I've tried to demonstrate various ways of setting
					up the observables, so ignore the lack of consistency
				*/
				this.email = ko.validate.observable('', /^[\w\.]+@[\w\.]+\.[a-zA-Z0-9]+$/)
					.fail(function(value) {
						self.validEmail(false);
					})
					.success(function(value) {
						self.validEmail(true);
					});
				this.password = ko.validate.observable('', {
					validate: function(value) {
						return typeof value === 'string' && value && value.length > 7;
					},
					success: function(value) {
						self.validPassword(true);
					},
					fail: function(value) {
						self.validPassword(false);
					}
				});
				this.retypePassword = ko.validate.observable('', {
					validate: function(value) {
						return value === self.password();
					},
					success: function(value) {
						self.passwordsMatch(true);
					},
					fail: function(value) {
						self.passwordsMatch(false);
					}
				});

				// DRY extraction of password match messaging
				this.showPasswordsMatchError = ko.computed(function() {
					return !self.passwordsMatch() && self.validPassword();
				});

				// Fun UI message & fake signup logic
				this.message = ko.observable();
				this.validSignUp = ko.computed(function() {
					return self.validEmail() && self.validPassword() && self.passwordsMatch()
				});
				this.showFunnyMessage = ko.observable(false);
				this.signup = function() {
					if (self.validSignUp() && self.email()) {
						self.message('Thank you for signing up ' + self.email() + '!');
						self.showFunnyMessage(true);
					} else {
						self.message(null);
					}
					if(!self.email() && !self.password()) {
						self.message('Did you forget something?');
					}
				};

				// Helper to display the code directly. Not intended to be too fancy
				this.codeDisplay = ko.observable(
					// replace tabs with spaces for readability
					ko.validate.Demo.toString()
						.replace(/\n\t{3}/g, '\n')
						.replace(/\t/g, '   ') 
				);
			};
			var demo = new ko.validate.Demo();
			var applyBindings = function() {
				ko.applyBindings(demo);
				document.removeEventListener( "DOMContentLoaded", applyBindings, false );
				// Make the JS pre tag pretty using https://code.google.com/p/google-code-prettify/
				prettyPrint();
			}
			document.addEventListener("DOMContentLoaded", applyBindings, false);
		</script>
	</head>
	<body>
		<nav class="navbar navbar-default" role="navigation">
			<div class="container-fluid">
				<div class="navbar-header">
					<a class="navbar-brand" href="https://github.com/Skiggz/knockout-validate" target="_blank">Knockout Validate</a>
				</div>
			</div>
		</nav>
		<section class="container">
			<section class="container">
				<h1>Knockout Validate Demo</h1>
				<blockquote>
					<p>A simple sign up form</p>
				</blockquote>
			</section>
			<section class="container">
				<form class="form-horizontal" role="form" data-bind="event: { submit: signup }">
					<div class="form-group" data-bind="css: { 'has-success': validEmail() && email(), 'has-error': !validEmail() }">
						<label for="email" class="col-sm-2 control-label">Email</label>
						<div class="col-sm-5">
							<input type="text" class="form-control" id="email" placeholder="email@example.com" data-bind="value: email">
						</div>
						<p class="help-block" data-bind="visible: !validEmail()">Email must be valid (username@domain.com)</p>
					</div>
					<div class="form-group" data-bind="css: { 'has-success': validPassword() && password(), 'has-error': !validPassword() }">
						<label for="inputPassword" class="col-sm-2 control-label">Password</label>
						<div class="col-sm-5">
						  <input type="password" class="form-control" id="inputPassword" placeholder="Password" data-bind="value: password">
						</div>
						<p class="help-block" data-bind="visible: !validPassword()">Password must be at least 8 characters</p>
					</div>
					<div class="form-group" data-bind="css: { 'has-success': passwordsMatch() && retypePassword(), 'has-error': showPasswordsMatchError }">
						<label for="retypePassword" class="col-sm-2 control-label">Retype Password</label>
						<div class="col-sm-5">
						  <input type="password" class="form-control" id="retypePassword" placeholder="Password" data-bind="value: retypePassword">
						</div>
						<p class="help-block" data-bind="visible: showPasswordsMatchError">Passwords must match</p>
					</div>
					<div class="form-group">
						<div class="col-sm-offset-2 col-sm-5">
							<button type="submit" class="btn btn-default">Sign up!</button>
							<p class="help-block" data-bind="text: message"></p>
							<p class="help-block" data-bind="visible: showFunnyMessage">Your year supply of imaginary cat food will arrive in 1024 business days.</p>
						</div>
					</div>
				</form>
			</section>
			<hr/>
			<section class="container">
				<h1>An Overview:</h1>
				<ul>
					<li><a href="https://github.com/Skiggz/knockout-validate" target="_blank">Knockout validate</a> allows you to add any kind of validation logic to your observables.</li>
					<li>This is one of the simplest examples, using knockout validate to do form validation.</li>
					<li>When the validation logic fails, the <code>fail</code> callback on the validated observable is called, updating the UI with error messaging by changing other observables.</li>
					<li>When validation succeeds, the <code>success</code> callback tells the form to be happier, also by changing other observables.</li>
					<li>
						It's very easy to <a href="https://github.com/Skiggz/knockout-validate" target="_blank">setup observables with validation.</a>
					</li>
					<li>You can use validation with <strong>ANY</strong> regular knockout observable. Objects, strings, integers, anything.</li>
					<li>It's simple, if the validation fails, the observable does not change and subscribers are not notified.</li>
					<li>If validation succeeds, the observable changes.</li>
					<li>On every validation, callbacks are made that are specified by you! Success, failure and even 'always' that fires on every validation</li>
					<li>If the value does not change, nothing happens (including the always callback). Ex: myObservable(myObservable()) does nothing.</li>
				</ul>
			</section>
			<section class="container">
				<h1>The Code</h1>
				<article class="container">
					<pre class="prettyprint" data-bind="html: codeDisplay">
					</pre>
				</article>
			</section>
			<footer class="container">
				<h1>What are you waiting for?</h1>
				<ul>
					<li>Knockout validate is very lightweight and easy to use!</li>
					<li><a href="https://github.com/Skiggz/knockout-validate" target="_blank">Check out the documentation</a> or get the source!</li>
					<li>If you find any issues, please <a href="https://github.com/Skiggz/knockout-validate/issues" target="_blank">report them</a>.</li>
					<li>If you have any suggestions, please <a href="https://github.com/Skiggz/knockout-validate/issues" target="_blank">report an enhancement</a> or <a href="https://github.com/Skiggz/knockout-validate/pulls" target="_blank">create a pull request!</a></li>
				</ul>
			</footer>
		</section>
	</body>
</html>