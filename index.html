<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Knockout Validate Demo</title>
		<!-- Bootstrap CSS -->
		<link rel="stylesheet" href="resources/bootstrap.css">
		<!-- Knockout -->
		<script src="resources/knockout.js"></script>
		<!-- Knockout Validate -->
		<script src="src/knockout-validate.js"></script>
		<script type="text/javascript">
			ko.validate.Demo = function() {
				var self = this;

				// We can use knockout-validate to ensure our flags are all booleans
				var validBoolean = function(value) {
					return typeof value === 'boolean';
				};

				// Valid flags for UI
				this.validEmail = ko.validate.observable(true, validBoolean);
				this.validPassword = ko.validate.observable(true, validBoolean);
				this.passwordsMatch = ko.validate.observable(true, validBoolean);
				/*
					A somewhat basic email regex. Not fool-proof
					but matches most emails

					I've tried to demonstrate various ways of setting
					up the observables, so ignore the lack of consistency
				*/
				this.email = ko.validate.observable('', /^[\w\.]+@[\w\.]+\.[a-zA-Z0-9]+$/)
					.fail(function(value) {
						self.validEmail(false);
					})
					.success(function(value) {
						self.validEmail(true);
					});
				this.password = ko.validate.observable('', {
					validate: function(value) {
						return typeof value === 'string' && value && value.length > 7;
					},
					success: function(value) {
						self.validPassword(true);
					},
					fail: function(value) {
						self.validPassword(false);
					}
				});
				this.retypePassword = ko.validate.observable('', {
					validate: function(value) {
						return value === self.password();
					},
					success: function(value) {
						self.passwordsMatch(true);
					},
					fail: function(value) {
						self.passwordsMatch(false);
					}
				});
				this.message = ko.observable();
				this.validSignUp = ko.computed(function() {
					return self.validEmail() && self.validPassword() && self.passwordsMatch()
				});
				this.signup = function() {
					if (self.validSignUp() && self.email()) {
						self.message(
							'Thank you for signing up ' + 
							self.email() + 
							'! Your year supply of imaginary cat food will arrive in 1024 business days.'
						);
					} else {
						self.message(null);
					}
					if(!self.email() && !self.password()) {
						self.message('Did you forget something?');
					}
				};
			};
			var demo = new ko.validate.Demo();
			var applyBindings = function() {
				ko.applyBindings(demo);
				document.removeEventListener( "DOMContentLoaded", applyBindings, false );
			}
			document.addEventListener("DOMContentLoaded", applyBindings, false);
		</script>
	</head>
	<body>
		<nav class="navbar navbar-default" role="navigation">
			<div class="container-fluid">
				<div class="navbar-header">
					<a class="navbar-brand" href="https://github.com/Skiggz/knockout-validate">Knockout Validate</a>
				</div>
			</div>
		</nav>
		<section class="container">
			<section class="container">
				<h1>Knockout Validate Demo</h1>
				<blockquote>
					<p>A simple sign up form</p>
				</blockquote>
			</section>
			<section class="container">
				<form class="form-horizontal" role="form" data-bind="event: { submit: signup }">
					<div class="form-group" data-bind="css: { 'has-success': validEmail() && email(), 'has-error': !validEmail() }">
						<label for="email" class="col-sm-2 control-label">Email</label>
						<div class="col-sm-5">
							<input type="text" class="form-control" id="email" placeholder="email@example.com" data-bind="value: email">
						</div>
						<p class="help-block" data-bind="visible: !validEmail()">Email must be valid (username@domain.com)</p>
					</div>
					<div class="form-group" data-bind="css: { 'has-success': validPassword() && password(), 'has-error': !validPassword() }">
						<label for="inputPassword" class="col-sm-2 control-label">Password</label>
						<div class="col-sm-5">
						  <input type="password" class="form-control" id="inputPassword" placeholder="Password" data-bind="value: password">
						</div>
						<p class="help-block" data-bind="visible: !validPassword()">Password must be at least 8 characters</p>
					</div>
					<div class="form-group" data-bind="css: { 'has-success': passwordsMatch() && retypePassword(), 'has-error': !passwordsMatch() }">
						<label for="retypePassword" class="col-sm-2 control-label">Retype Password</label>
						<div class="col-sm-5">
						  <input type="password" class="form-control" id="retypePassword" placeholder="Password" data-bind="value: retypePassword">
						</div>
						<p class="help-block" data-bind="visible: !passwordsMatch()">Passwords must match</p>
					</div>
					<div class="form-group">
						<div class="col-sm-offset-2 col-sm-5">
							<button type="submit" class="btn btn-default">Sign up!</button>
							<p class="help-block" data-bind="text: message"></p>
						</div>
					</div>
				</form>
			</section>
		</section>
	</body>
</html>